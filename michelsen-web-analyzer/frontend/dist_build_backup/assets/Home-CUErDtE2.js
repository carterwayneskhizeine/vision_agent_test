import{d as D,r as i,c as U,a as n,b as e,e as u,t as f,w as S,v as T,n as V,u as B,o as r}from"./index-nH75DhFP.js";import{_ as E}from"./_plugin-vue_export-helper-DlAUqK2U.js";const L={class:"space-y-8"},O={class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},P={class:"card bg-base-100 shadow-xl"},z={class:"card-body"},M={class:"form-control"},F={key:0,class:"video-preview mt-4"},N=["src"],H={key:1,class:"mt-4"},$={class:"alert alert-success"},J={class:"card bg-base-100 shadow-xl"},q={class:"card-body"},G={class:"form-control"},K={key:0,class:"video-preview mt-4"},Q=["src"],W={key:1,class:"mt-4"},X={class:"alert alert-success"},Y={class:"card bg-base-100 shadow-xl"},Z={class:"card-body text-center"},ee={class:"form-control mb-6"},se={class:"cursor-pointer label justify-center"},te={class:"card-actions justify-center"},ae=["disabled"],oe={key:0},le={key:1},ne={key:0,class:"analysis-progress mt-6"},re={class:"mb-2"},ie={class:"text-sm font-medium"},ce=["value"],de={class:"mt-2 text-sm text-base-content/70"},ue={key:1,class:"alert alert-warning mt-4"},ve=D({__name:"Home",setup(pe){const k=B(),v=i(null),p=i(null),y=i(""),b=i(""),w=i(!0),c=i(!1),o=i(0),l=i(""),h=U(()=>v.value&&p.value&&!c.value),j=a=>{var d;const t=(d=a.target.files)==null?void 0:d[0];t&&(v.value=t,y.value=URL.createObjectURL(t))},A=a=>{var d;const t=(d=a.target.files)==null?void 0:d[0];t&&(p.value=t,b.value=URL.createObjectURL(t))},R=async()=>{if(h.value){c.value=!0,o.value=0,l.value="正在初始化分析...";try{l.value="上传老师示范视频...",o.value=10;const a=new FormData;if(a.append("file",v.value),!(await fetch("/api/upload/teacher",{method:"POST",body:a})).ok)throw new Error("老师视频上传失败");l.value="上传学生实验视频...",o.value=20;const t=new FormData;if(t.append("file",p.value),!(await fetch("/api/upload/student",{method:"POST",body:t})).ok)throw new Error("学生视频上传失败");l.value="启动AI分析引擎...",o.value=30;const g=await fetch("/api/analysis/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({include_device_detection:w.value})});if(!g.ok)throw new Error("AI分析启动失败");const C=(await g.json()).analysis_id;l.value="AI正在分析实验步骤...";let x=!1;for(;!x;){await new Promise(I=>setTimeout(I,2e3));const _=await fetch(`/api/analysis/progress/${C}`);if(!_.ok)throw new Error("无法获取分析进度");const m=await _.json();if(o.value=Math.min(30+m.progress*.7,100),l.value=m.current_step||"AI正在分析中...",m.status==="completed")x=!0,o.value=100,l.value="分析完成！正在跳转到结果页面...";else if(m.status==="error")throw new Error(m.error||"分析过程中出现错误")}await new Promise(_=>setTimeout(_,1e3)),k.push("/analysis")}catch(a){console.error("分析失败:",a),alert(`AI分析失败: ${a.message}

请检查：
1. 后端服务是否正常运行
2. 视频文件是否正确
3. 网络连接是否稳定`),o.value=0,l.value=""}finally{c.value=!1}}};return(a,s)=>(r(),n("div",L,[s[10]||(s[10]=e("div",{class:"text-center"},[e("h1",{class:"text-4xl font-bold text-primary mb-4"}," 🧪 迈克尔逊干涉实验 AI 分析系统 "),e("p",{class:"text-lg text-base-content/70"}," 上传实验视频，AI 智能分析实验步骤并生成详细报告 ")],-1)),e("div",O,[e("div",P,[e("div",z,[s[3]||(s[3]=e("h2",{class:"card-title text-primary"}," 👨‍🏫 老师示范视频 ",-1)),e("div",M,[s[1]||(s[1]=e("label",{class:"label"},[e("span",{class:"label-text"},"选择老师示范视频文件")],-1)),e("input",{type:"file",accept:"video/*",class:"file-input file-input-bordered file-input-primary",onChange:j},null,32)]),y.value?(r(),n("div",F,[e("video",{controls:"",class:"w-full max-h-64 object-contain",src:y.value}," 您的浏览器不支持视频播放 ",8,N)])):u("",!0),v.value?(r(),n("div",H,[e("div",$,[s[2]||(s[2]=e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",null,"老师视频已上传："+f(v.value.name),1)])])):u("",!0)])]),e("div",J,[e("div",q,[s[6]||(s[6]=e("h2",{class:"card-title text-secondary"}," 🎓 学生实验视频 ",-1)),e("div",G,[s[4]||(s[4]=e("label",{class:"label"},[e("span",{class:"label-text"},"选择学生实验视频文件")],-1)),e("input",{type:"file",accept:"video/*",class:"file-input file-input-bordered file-input-secondary",onChange:A},null,32)]),b.value?(r(),n("div",K,[e("video",{controls:"",class:"w-full max-h-64 object-contain",src:b.value}," 您的浏览器不支持视频播放 ",8,Q)])):u("",!0),p.value?(r(),n("div",W,[e("div",X,[s[5]||(s[5]=e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",null,"学生视频已上传："+f(p.value.name),1)])])):u("",!0)])])]),e("div",Y,[e("div",Z,[s[9]||(s[9]=e("h2",{class:"card-title justify-center text-2xl mb-4"}," 🚀 AI 分析控制 ",-1)),e("div",ee,[e("label",se,[S(e("input",{type:"checkbox","onUpdate:modelValue":s[0]||(s[0]=t=>w.value=t),class:"checkbox checkbox-primary"},null,512),[[T,w.value]]),s[7]||(s[7]=e("span",{class:"label-text ml-2"},"包含设备检测 (108秒单帧)",-1))])]),e("div",te,[e("button",{class:V(["btn btn-primary btn-lg",{"btn-disabled":!h.value,loading:c.value}]),disabled:!h.value||c.value,onClick:R},[c.value?(r(),n("span",le,"正在分析中...")):(r(),n("span",oe,"🧠 开始 AI 实验步骤分析"))],10,ae)]),c.value?(r(),n("div",ne,[e("div",re,[e("span",ie,"分析进度: "+f(o.value)+"%",1)]),e("progress",{class:"progress progress-primary",value:o.value,max:"100"},null,8,ce),e("div",de,f(l.value),1)])):u("",!0),h.value?u("",!0):(r(),n("div",ue,s[8]||(s[8]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})],-1),e("span",null,"请先上传老师示范视频和学生实验视频",-1)])))])])]))}}),fe=E(ve,[["__scopeId","data-v-c6a1e92c"]]);export{fe as default};
