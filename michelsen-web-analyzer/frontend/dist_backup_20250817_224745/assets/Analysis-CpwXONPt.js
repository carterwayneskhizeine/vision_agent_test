import{d as K,r as g,c as $,f as L,a as l,b as t,e as E,g as j,h as D,t as a,F as x,i as b,j as u,k as T,o as i,n as R}from"./index-W16rpuLb.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const H={class:"space-y-8"},q={key:0,class:"text-center py-16"},G={key:1,class:"stats shadow w-full"},J={class:"stat"},O={class:"stat-value text-primary"},P={class:"stat"},Q={class:"stat-value text-secondary"},W={class:"stat"},X={class:"stat-value text-accent"},Y={class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},Z={class:"space-y-6"},tt={class:"card-body"},st={class:"card-title text-lg"},et={class:"badge badge-primary"},ot={class:"screenshot-container"},nt=["src","alt","onClick"],at={class:"space-y-2"},lt={class:"list-disc list-inside space-y-1 text-sm"},it={class:"mt-3 p-3 bg-base-200 rounded-lg"},dt={class:"text-sm"},rt={class:"space-y-6"},ct={key:0,class:"card bg-base-100 shadow-xl mb-6"},ut={class:"card-body"},mt={class:"screenshot-container"},_t=["src"],pt={class:"mt-3 p-3 bg-accent/10 rounded-lg"},vt={class:"text-sm"},gt={class:"card-body"},xt={class:"card-title text-lg"},bt={class:"badge badge-secondary"},ht={class:"screenshot-container"},ft=["src","alt","onClick"],yt={class:"space-y-2"},kt={class:"list-disc list-inside space-y-1 text-sm"},wt={class:"mt-3 p-3 bg-base-200 rounded-lg"},$t={class:"text-sm"},Ct={key:2,class:"space-y-6"},It={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},At={class:"card bg-base-100 shadow-xl"},St={class:"card-body"},Et={class:"stats stats-vertical shadow"},jt={class:"stat"},Dt={class:"stat-value text-primary"},Rt={class:"stat"},Bt={class:"stat-value text-success"},Ft={class:"stat"},Mt={class:"stat-value text-accent"},Nt={class:"card bg-base-100 shadow-xl"},Vt={class:"card-body"},Ut={class:"screenshot-container"},Kt=["src"],Lt={key:1,class:"flex items-center justify-center h-48 bg-base-200 rounded-lg border-2 border-dashed border-base-300"},Tt={class:"card bg-base-100 shadow-xl"},zt={class:"card-body"},Ht={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4"},qt={class:"card-body p-4"},Gt={class:"font-bold text-sm"},Jt={class:"text-xs space-y-1"},Ot={class:"mt-2"},Pt={class:"text-center"},Qt={id:"image_modal",class:"modal"},Wt={class:"modal-box max-w-4xl"},Xt={class:"font-bold text-lg mb-4"},Yt=["src","alt"],Zt=K({__name:"Analysis",setup(ts){const y=g([]),v=g([]),c=g(null),m=g(""),C=g(""),k=g(""),I=$(()=>y.value.length),A=$(()=>v.value.length),B=$(()=>{if(v.value.length===0)return 0;const n=v.value.reduce((s,r)=>s+(r.confidence||0),0);return Math.round(n/v.value.length*100)}),h=n=>`/api/analysis/screenshots/${n}`,F=n=>n>=.8?"high":n>=.6?"medium":"low",f=(n,s)=>{C.value=n,k.value=s;const r=document.getElementById("image_modal");r==null||r.showModal()},S=n=>{const s=n.target;console.warn("图片加载失败:",s.src),s.src.includes("detection_result.png")&&(m.value="")},M=n=>{const[s,r,e,d]=n;return`(${s}, ${r}) - (${e}, ${d})`},N=n=>n>=.8?"badge-success":n>=.6?"badge-warning":"badge-error",V=n=>n>=.8?"高":n>=.6?"中":"低",U=async()=>{try{console.log("正在加载AI分析结果...");const n=await fetch("/api/analysis/reports/screenshot_explanations.json");if(!n.ok)throw new Error(`截图数据加载失败: ${n.status}`);const s=await n.json();console.log("截图数据:",s);const r=await fetch("/api/analysis/reports/experiment_steps_analysis.json");if(!r.ok)throw new Error(`分析报告加载失败: ${r.status}`);const e=await r.json();console.log("分析报告:",e);const d=[];if(e.teacher_analysis&&e.teacher_analysis.steps)for(const o of e.teacher_analysis.steps){const _=`teacher_step_${o.step_id.toString().padStart(2,"0")}_t${o.timestamp}s.png`,p=s[_];d.push({step_id:o.step_id,step_name:o.step_name,timestamp:o.timestamp,time_str:o.time_str,description:Array.isArray(o.description)?o.description:[o.description],explanation:p?p.explanation:`老师在${o.timestamp}秒时执行: ${o.step_name}`,screenshot_filename:_})}const w=[];if(e.student_analysis&&e.student_analysis.steps)for(const o of e.student_analysis.steps){const _=`student_step_${o.step_id.toString().padStart(2,"0")}_t${o.timestamp}s.png`,p=s[_];w.push({step_id:o.step_id,step_name:o.step_name,timestamp:o.timestamp,time_str:o.time_str,description:Array.isArray(o.description)?o.description:[o.description],explanation:p?p.explanation:`学生在${o.timestamp}秒时执行: ${o.step_name}`,screenshot_filename:_,confidence:o.confidence||.7})}y.value=d,v.value=w;try{const o=await fetch("/api/analysis/reports/detection_report.json");if(o.ok){const _=await o.json();c.value=_,console.log("设备检测结果:",_);try{(await fetch("http://localhost:8080/static/images/detection_result.png",{method:"HEAD"})).ok&&(m.value="http://localhost:8080/static/images/detection_result.png")}catch{console.log("设备检测图片不存在")}}else console.log("设备检测结果不存在或加载失败")}catch(o){console.log("设备检测结果加载失败:",o)}console.log("加载完成:",{teacher:d.length,student:w.length,detection:c.value?c.value.components_detected:"无"})}catch(n){console.error("加载分析结果失败:",n),alert(`加载分析结果失败: ${n.message}

请确保：
1. 后端服务正在运行
2. 已完成AI分析
3. 分析结果文件存在`)}};return L(()=>{U()}),(n,s)=>{const r=T("router-link");return i(),l("div",H,[s[37]||(s[37]=t("div",{class:"text-center"},[t("h1",{class:"text-4xl font-bold text-primary mb-4"}," 📊 AI 分析结果 "),t("p",{class:"text-lg text-base-content/70"}," 迈克尔逊干涉实验步驤智能对比分析 ")],-1)),I.value===0&&A.value===0?(i(),l("div",q,[s[3]||(s[3]=t("div",{class:"text-6xl mb-4"},"🤖",-1)),s[4]||(s[4]=t("h2",{class:"text-2xl font-bold text-base-content mb-4"},"暂无分析结果",-1)),s[5]||(s[5]=t("p",{class:"text-base-content/70 mb-6"}," 请先在主页上传视频并完成AI分析，然后再查看结果 ",-1)),j(r,{to:"/",class:"btn btn-primary btn-lg"},{default:D(()=>s[2]||(s[2]=[u(" 📹 返回上传页面 ",-1)])),_:1,__:[2]})])):(i(),l("div",G,[t("div",J,[s[6]||(s[6]=t("div",{class:"stat-figure text-primary"}," 👨‍🏫 ",-1)),s[7]||(s[7]=t("div",{class:"stat-title"},"老师示范步驤",-1)),t("div",O,a(I.value),1),s[8]||(s[8]=t("div",{class:"stat-desc"},"个标准步驤",-1))]),t("div",P,[s[9]||(s[9]=t("div",{class:"stat-figure text-secondary"}," 🎓 ",-1)),s[10]||(s[10]=t("div",{class:"stat-title"},"学生操作步驤",-1)),t("div",Q,a(A.value),1),s[11]||(s[11]=t("div",{class:"stat-desc"},"个识别步驤",-1))]),t("div",W,[s[12]||(s[12]=t("div",{class:"stat-figure text-accent"}," 🎯 ",-1)),s[13]||(s[13]=t("div",{class:"stat-title"},"分析精度",-1)),t("div",X,a(B.value)+"%",1),s[14]||(s[14]=t("div",{class:"stat-desc"},"平均置信度",-1))])])),t("div",Y,[t("div",Z,[s[17]||(s[17]=t("h2",{class:"text-2xl font-bold text-primary flex items-center"}," 👨‍🏫 老师示范步驤分析 ",-1)),(i(!0),l(x,null,b(y.value,e=>(i(),l("div",{key:`teacher-${e.step_id}-${e.timestamp}`,class:"step-card"},[t("div",tt,[t("h3",st,[u(" 步驤"+a(e.step_id)+"："+a(e.step_name)+" ",1),t("div",et,"t="+a(e.timestamp)+"s",1)]),t("div",ot,[t("img",{src:h(e.screenshot_filename),alt:e.step_name,class:"step-screenshot",onClick:d=>f(h(e.screenshot_filename),e.step_name)},null,8,nt)]),t("div",at,[s[16]||(s[16]=t("h4",{class:"font-semibold text-base-content"},"操作内容：",-1)),t("ul",lt,[(i(!0),l(x,null,b(e.description,d=>(i(),l("li",{key:d,class:"text-base-content/80"},a(d),1))),128))]),t("div",it,[t("p",dt,[s[15]||(s[15]=t("strong",{class:"text-primary"},"AI 解读：",-1)),u(" "+a(e.explanation),1)])])])])]))),128))]),t("div",rt,[s[22]||(s[22]=t("h2",{class:"text-2xl font-bold text-secondary flex items-center"}," 🎓 学生操作步驤分析 ",-1)),m.value?(i(),l("div",ct,[t("div",ut,[s[19]||(s[19]=t("h3",{class:"card-title text-accent mb-4"}," 🔍 学生实验设备检测结果 (108秒) ",-1)),t("div",mt,[t("img",{src:m.value,alt:"学生实验设备检测结果",class:"step-screenshot cursor-pointer",onClick:s[0]||(s[0]=e=>f(m.value,"学生实验设备检测结果 (108秒)")),onError:S},null,40,_t)]),t("div",pt,[t("p",vt,[s[18]||(s[18]=t("strong",{class:"text-accent"},"AI设备检测：",-1)),u(" "+a(c.value?`成功检测到 ${c.value.components_detected}/${c.value.total_components_to_detect} 个实验设备`:"正在加载设备检测结果..."),1)])])])])):E("",!0),(i(!0),l(x,null,b(v.value,e=>(i(),l("div",{key:`student-${e.step_id}-${e.timestamp}`,class:"step-card"},[t("div",gt,[t("h3",xt,[u(" 步驤"+a(e.step_id)+"："+a(e.step_name)+" ",1),t("div",bt,"t="+a(e.timestamp)+"s",1),t("div",{class:R(["confidence-badge",F(e.confidence)])}," 置信度: "+a((e.confidence*100).toFixed(0))+"% ",3)]),t("div",ht,[t("img",{src:h(e.screenshot_filename),alt:e.step_name,class:"step-screenshot",onClick:d=>f(h(e.screenshot_filename),e.step_name)},null,8,ft)]),t("div",yt,[s[21]||(s[21]=t("h4",{class:"font-semibold text-base-content"},"操作内容：",-1)),t("ul",kt,[(i(!0),l(x,null,b(e.description,d=>(i(),l("li",{key:d,class:"text-base-content/80"},a(d),1))),128))]),t("div",wt,[t("p",$t,[s[20]||(s[20]=t("strong",{class:"text-secondary"},"AI 解读：",-1)),u(" "+a(e.explanation),1)])])])])]))),128))])]),c.value?(i(),l("div",Ct,[s[34]||(s[34]=t("h2",{class:"text-2xl font-bold text-accent flex items-center"}," 🔬 设备检测结果 ",-1)),t("div",It,[t("div",At,[t("div",St,[s[26]||(s[26]=t("h3",{class:"card-title text-accent"},"📊 检测统计",-1)),t("div",Et,[t("div",jt,[s[23]||(s[23]=t("div",{class:"stat-title"},"总检测设备数",-1)),t("div",Dt,a(c.value.total_components_to_detect),1)]),t("div",Rt,[s[24]||(s[24]=t("div",{class:"stat-title"},"成功检测数",-1)),t("div",Bt,a(c.value.components_detected),1)]),t("div",Ft,[s[25]||(s[25]=t("div",{class:"stat-title"},"检测成功率",-1)),t("div",Mt,a((c.value.detection_rate*100).toFixed(1))+"%",1)])])])]),t("div",Nt,[t("div",Vt,[s[28]||(s[28]=t("h3",{class:"card-title text-accent"},"🖼️ 检测结果图",-1)),t("div",Ut,[m.value?(i(),l("img",{key:0,src:m.value,alt:"设备检测结果",class:"step-screenshot cursor-pointer",onClick:s[1]||(s[1]=e=>f(m.value,"设备检测结果")),onError:S},null,40,Kt)):(i(),l("div",Lt,s[27]||(s[27]=[t("div",{class:"text-center text-base-content/50"},[t("div",{class:"text-4xl mb-2"},"🔍"),t("p",null,"设备检测结果图片加载中...")],-1)])))]),s[29]||(s[29]=t("p",{class:"text-sm text-base-content/70 mt-2"}," 点击图片查看详细的设备检测标注结果 ",-1))])])]),t("div",Tt,[t("div",zt,[s[33]||(s[33]=t("h3",{class:"card-title text-accent"},"🔍 检测详情",-1)),t("div",Ht,[(i(!0),l(x,null,b(c.value.detections,(e,d)=>(i(),l("div",{key:d,class:"card bg-base-200 shadow"},[t("div",qt,[t("h4",Gt,a(e.name),1),t("div",Jt,[t("p",null,[s[30]||(s[30]=t("strong",null,"置信度:",-1)),u(" "+a((e.confidence*100).toFixed(1))+"%",1)]),t("p",null,[s[31]||(s[31]=t("strong",null,"检测方法:",-1)),u(" "+a(e.method),1)]),t("p",null,[s[32]||(s[32]=t("strong",null,"位置:",-1)),u(" "+a(M(e.bbox)),1)])]),t("div",Ot,[t("div",{class:R(["badge",N(e.confidence)])},a(V(e.confidence)),3)])])]))),128))])])])])):E("",!0),t("div",Pt,[j(r,{to:"/",class:"btn btn-primary btn-lg"},{default:D(()=>s[35]||(s[35]=[u(" 🔄 重新分析 ",-1)])),_:1,__:[35]})]),t("dialog",Qt,[t("div",Wt,[t("h3",Xt,a(k.value),1),t("img",{src:C.value,alt:k.value,class:"w-full h-auto"},null,8,Yt),s[36]||(s[36]=t("div",{class:"modal-action"},[t("form",{method:"dialog"},[t("button",{class:"btn"},"关闭")])],-1))])])])}}}),os=z(Zt,[["__scopeId","data-v-9f2da843"]]);export{os as default};
