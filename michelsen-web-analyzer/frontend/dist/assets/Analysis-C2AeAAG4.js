import{d as q,r as u,c as f,g as G,a as i,b as t,e as h,F as y,h as k,f as _,t as a,i as B,j as F,k as J,o as d,n as C,_ as O}from"./index-BkKPq0f4.js";const Q={class:"space-y-8"},W={class:"flex justify-between over"},X={class:"w-[70%]"},Y={class:"video-box"},Z={key:0,class:"video-preview"},tt=["src"],st={class:"video-step-time"},et=["onClick"],ot=["title"],nt={class:"w-[28%]"},at={class:"scroll h-[80vh]"},lt={key:0,class:"card bg-base-100 shadow-xl mb-6"},it={class:"card-body"},dt={class:"screenshot-container"},ct=["src"],rt={class:"mt-3 p-3 bg-accent/10 rounded-lg"},ut={class:"text-sm"},vt={class:"card-body"},mt=["onClick"],pt={class:"flex"},_t={class:"badge badge-secondary"},gt={class:"screenshot-container"},xt=["src","alt","onClick"],bt={class:"space-y-2"},ft={class:"list-disc list-inside space-y-1 text-sm"},ht={class:"mt-3 p-3 bg-base-200 rounded-lg"},yt={class:"text-sm"},kt={class:"container mx-auto"},wt={key:0,class:"text-center py-16"},$t={key:1,class:"stats shadow w-full"},Ct={class:"stat"},It={class:"stat-value text-primary"},At={class:"stat"},St={class:"stat-value text-secondary"},Et={class:"stat"},Rt={class:"stat-value text-accent"},jt={key:2,class:"space-y-6 mb-4"},Dt={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Tt={class:"card bg-base-100 shadow-xl"},Vt={class:"card-body"},Bt={class:"stats stats-vertical shadow"},Ft={class:"stat"},Ut={class:"stat-value text-primary"},Mt={class:"stat"},Nt={class:"stat-value text-success"},Lt={class:"stat"},Kt={class:"stat-value text-accent"},Pt={class:"card bg-base-100 shadow-xl"},zt={class:"card-body"},Ht={class:"screenshot-container"},qt=["src"],Gt={key:1,class:"flex items-center justify-center h-48 bg-base-200 rounded-lg border-2 border-dashed border-base-300"},Jt={key:3,class:"space-y-6"},Ot={class:"card bg-base-100 shadow-xl"},Qt={class:"card-body"},Wt={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4"},Xt={class:"card-body p-4"},Yt={class:"font-bold text-sm"},Zt={class:"text-xs space-y-1"},ts={class:"mt-2"},ss={class:"text-center"},es={id:"image_modal",class:"modal"},os={class:"modal-box max-w-4xl"},ns={class:"font-bold text-lg mb-4"},as=["src","alt"],ls=q({__name:"Analysis",setup(is){const I=u([]),v=u([]),r=u(null),m=u(""),A=u(""),w=u(""),S=f(()=>I.value.length),E=f(()=>v.value.length),U=f(()=>{if(v.value.length===0)return 0;const o=v.value.reduce((s,l)=>s+(l.confidence||0),0);return Math.round(o/v.value.length*100)}),R=o=>`http://lab-score.fantasy-lab.com/api/analysis/screenshots/${o}`,M=o=>o>=.8?"high":o>=.6?"medium":"low",$=(o,s)=>{A.value=o,w.value=s;const l=document.getElementById("image_modal");l==null||l.showModal()},j=o=>{const s=o.target;console.warn("图片加载失败:",s.src),s.src.includes("detection_result.png")&&(m.value="")},x=u(null),D=o=>{x.value.currentTime=o,x.value.play()},N=u(0),T=u(null),L=()=>{const o=x.value.currentTime;console.log(2222,o),v.value.forEach((s,l)=>{o>=s.timestamp?(s.status="active",N.value=l,T.value.scrollLeft=l*200):s.status=""})},K=o=>{const[s,l,e,c]=o;return`(${s}, ${l}) - (${e}, ${c})`},P=o=>o>=.8?"badge-success":o>=.6?"badge-warning":"badge-error",z=o=>o>=.8?"高":o>=.6?"中":"低",V=f(()=>localStorage.getItem("studentVideoUrl")),H=async()=>{try{console.log("正在加载AI分析结果...");const o=await fetch("http://lab-score.fantasy-lab.com/api/analysis/reports/screenshot_explanations.json");if(!o.ok)throw new Error(`截图数据加载失败: ${o.status}`);const s=await o.json();console.log("截图数据:",s);const l=await fetch("http://lab-score.fantasy-lab.com/api/analysis/reports/experiment_steps_analysis.json");if(!l.ok)throw new Error(`分析报告加载失败: ${l.status}`);const e=await l.json();console.log("分析报告:",e);const c=[];if(e.teacher_analysis&&e.teacher_analysis.steps)for(const n of e.teacher_analysis.steps){const p=`teacher_step_${n.step_id.toString().padStart(2,"0")}_t${n.timestamp}s.png`,g=s[p];c.push({step_id:n.step_id,step_name:n.step_name,timestamp:n.timestamp,time_str:n.time_str,description:Array.isArray(n.description)?n.description:[n.description],explanation:g?g.explanation:`老师在${n.timestamp}秒时执行: ${n.step_name}`,screenshot_filename:p})}const b=[];if(e.student_analysis&&e.student_analysis.steps)for(const n of e.student_analysis.steps){const p=`student_step_${n.step_id.toString().padStart(2,"0")}_t${n.timestamp}s.png`,g=s[p];b.push({step_id:n.step_id,step_name:n.step_name,timestamp:n.timestamp,time_str:n.time_str,description:Array.isArray(n.description)?n.description:[n.description],explanation:g?g.explanation:`学生在${n.timestamp}秒时执行: ${n.step_name}`,screenshot_filename:p,confidence:n.confidence||.7})}I.value=c,v.value=b;try{const n=await fetch("http://lab-score.fantasy-lab.com/api/analysis/reports/detection_report.json");if(n.ok){const p=await n.json();r.value=p,console.log("设备检测结果:",p);try{(await fetch("http://lab-score.fantasy-lab.com/static/images/detection_result.png",{method:"HEAD"})).ok&&(m.value="http://lab-score.fantasy-lab.com/static/images/detection_result.png")}catch{console.log("设备检测图片不存在")}}else console.log("设备检测结果不存在或加载失败")}catch(n){console.log("设备检测结果加载失败:",n)}console.log("加载完成:",{teacher:c.length,student:b.length,detection:r.value?r.value.components_detected:"无"})}catch(o){console.error("加载分析结果失败:",o),alert(`加载分析结果失败: ${o.message}

请确保：
1. 后端服务正在运行
2. 已完成AI分析
3. 分析结果文件存在`)}};return G(()=>{H()}),(o,s)=>{const l=J("router-link");return d(),i("div",Q,[s[37]||(s[37]=t("div",{class:"text-center"},[t("h1",{class:"text-4xl font-bold text-primary mb-4"},"📊 AI 分析结果")],-1)),t("div",W,[t("div",X,[s[3]||(s[3]=t("h2",{class:"text-2xl font-bold text-primary mb-4 flex items-center"}," 👨‍🏫 学生实验视频 ",-1)),t("div",Y,[V.value?(d(),i("div",Z,[t("video",{controls:"",ref_key:"videoRef",ref:x,class:"w-full h-[65vh] object-contain",src:V.value,onTimeupdate:L}," 您的浏览器不支持视频播放 ",40,tt)])):h("",!0),t("div",{class:"video-step-box",ref_key:"stepRef",ref:T},[(d(!0),i(y,null,k(v.value,(e,c)=>(d(),i("div",{class:C(["video-step-item",{active:e.status==="active"}]),key:c},[t("div",st,[t("div",{class:"time-block text-sm",onClick:b=>D(e.timestamp)},a(e.time_str),9,et),s[2]||(s[2]=t("div",{class:"time-line"},null,-1))]),t("div",{class:"video-step-name text-sm",title:e.step_name},a(c+1+e.step_name),9,ot)],2))),128))],512)])]),t("div",nt,[s[8]||(s[8]=t("h2",{class:"text-2xl mb-4 font-bold text-secondary flex items-center"}," 🎓 学生操作步驤分析 ",-1)),t("div",at,[m.value?(d(),i("div",lt,[t("div",it,[s[5]||(s[5]=t("h3",{class:"card-title text-accent mb-4"}," 🔍 学生实验设备检测结果 (108秒) ",-1)),t("div",dt,[t("img",{src:m.value,alt:"学生实验设备检测结果",class:"step-screenshot cursor-pointer",onClick:s[0]||(s[0]=e=>$(m.value,"学生实验设备检测结果 (108秒)")),onError:j},null,40,ct)]),t("div",rt,[t("p",ut,[s[4]||(s[4]=t("strong",{class:"text-accent"},"AI设备检测：",-1)),_(" "+a(r.value?`成功检测到 ${r.value.components_detected}/${r.value.total_components_to_detect} 个实验设备`:"正在加载设备检测结果..."),1)])])])])):h("",!0),(d(!0),i(y,null,k(v.value,e=>(d(),i("div",{key:`student-${e.step_id}-${e.timestamp}`,class:"step-card"},[t("div",vt,[t("h3",{class:"card-title text-lg",style:{"flex-direction":"column"},onClick:c=>D(e.timestamp)},[_(" 步驤"+a(e.step_id)+"："+a(e.step_name)+" ",1),t("div",pt,[t("div",_t," 时间："+a(e.timestamp)+"s ",1),t("div",{class:C(["confidence-badge",M(e.confidence)]),style:{"flex-shrink":"0","line-height":"1.25rem",height:"auto"}}," 置信度: "+a((e.confidence*100).toFixed(0))+"% ",3)])],8,mt),t("div",gt,[t("img",{src:R(e.screenshot_filename),alt:e.step_name,class:"step-screenshot",onClick:c=>$(R(e.screenshot_filename),e.step_name)},null,8,xt)]),t("div",bt,[s[7]||(s[7]=t("h4",{class:"font-semibold text-base-content"},"操作内容：",-1)),t("ul",ft,[(d(!0),i(y,null,k(e.description,c=>(d(),i("li",{key:c,class:"text-base-content/80"},a(c),1))),128))]),t("div",ht,[t("p",yt,[s[6]||(s[6]=t("strong",{class:"text-secondary"},"AI 解读：",-1)),_(" "+a(e.explanation),1)])])])])]))),128))])])]),t("div",kt,[s[34]||(s[34]=t("div",{class:"text-center"},[t("p",{class:"text-lg mb-4 text-base-content/70"}," 迈克尔逊干涉实验步驤智能对比分析 ")],-1)),S.value===0&&E.value===0?(d(),i("div",wt,[s[10]||(s[10]=t("div",{class:"text-6xl mb-4"},"🤖",-1)),s[11]||(s[11]=t("h2",{class:"text-2xl font-bold text-base-content mb-4"},"暂无分析结果",-1)),s[12]||(s[12]=t("p",{class:"text-base-content/70 mb-6"}," 请先在主页上传视频并完成AI分析，然后再查看结果 ",-1)),B(l,{to:"/",class:"btn btn-primary btn-lg"},{default:F(()=>s[9]||(s[9]=[_(" 📹 返回上传页面 ",-1)])),_:1,__:[9]})])):(d(),i("div",$t,[t("div",Ct,[s[13]||(s[13]=t("div",{class:"stat-figure text-primary"},"👨‍🏫",-1)),s[14]||(s[14]=t("div",{class:"stat-title"},"老师示范步驤",-1)),t("div",It,a(S.value),1),s[15]||(s[15]=t("div",{class:"stat-desc"},"个标准步驤",-1))]),t("div",At,[s[16]||(s[16]=t("div",{class:"stat-figure text-secondary"},"🎓",-1)),s[17]||(s[17]=t("div",{class:"stat-title"},"学生操作步驤",-1)),t("div",St,a(E.value),1),s[18]||(s[18]=t("div",{class:"stat-desc"},"个识别步驤",-1))]),t("div",Et,[s[19]||(s[19]=t("div",{class:"stat-figure text-accent"},"🎯",-1)),s[20]||(s[20]=t("div",{class:"stat-title"},"分析精度",-1)),t("div",Rt,a(U.value)+"%",1),s[21]||(s[21]=t("div",{class:"stat-desc"},"平均置信度",-1))])])),r.value?(d(),i("div",jt,[s[29]||(s[29]=t("h2",{class:"text-2xl font-bold text-accent flex items-center"}," 🔬 设备检测结果 ",-1)),t("div",Dt,[t("div",Tt,[t("div",Vt,[s[25]||(s[25]=t("h3",{class:"card-title text-accent"},"📊 检测统计",-1)),t("div",Bt,[t("div",Ft,[s[22]||(s[22]=t("div",{class:"stat-title"},"总检测设备数",-1)),t("div",Ut,a(r.value.total_components_to_detect),1)]),t("div",Mt,[s[23]||(s[23]=t("div",{class:"stat-title"},"成功检测数",-1)),t("div",Nt,a(r.value.components_detected),1)]),t("div",Lt,[s[24]||(s[24]=t("div",{class:"stat-title"},"检测成功率",-1)),t("div",Kt,a((r.value.detection_rate*100).toFixed(1))+"% ",1)])])])]),t("div",Pt,[t("div",zt,[s[27]||(s[27]=t("h3",{class:"card-title text-accent"},"🖼️ 检测结果图",-1)),t("div",Ht,[m.value?(d(),i("img",{key:0,src:m.value,alt:"设备检测结果",class:"step-screenshot cursor-pointer",onClick:s[1]||(s[1]=e=>$(m.value,"设备检测结果")),onError:j},null,40,qt)):(d(),i("div",Gt,s[26]||(s[26]=[t("div",{class:"text-center text-base-content/50"},[t("div",{class:"text-4xl mb-2"},"🔍"),t("p",null,"设备检测结果图片加载中...")],-1)])))]),s[28]||(s[28]=t("p",{class:"text-sm text-base-content/70 mt-2"}," 点击图片查看详细的设备检测标注结果 ",-1))])])])])):h("",!0),r.value?(d(),i("div",Jt,[t("div",Ot,[t("div",Qt,[s[33]||(s[33]=t("h3",{class:"card-title text-accent"},"🔍 检测详情",-1)),t("div",Wt,[(d(!0),i(y,null,k(r.value.detections,(e,c)=>(d(),i("div",{key:c,class:"card bg-base-200 shadow"},[t("div",Xt,[t("h4",Yt,a(e.name),1),t("div",Zt,[t("p",null,[s[30]||(s[30]=t("strong",null,"置信度:",-1)),_(" "+a((e.confidence*100).toFixed(1))+"% ",1)]),t("p",null,[s[31]||(s[31]=t("strong",null,"检测方法:",-1)),_(" "+a(e.method),1)]),t("p",null,[s[32]||(s[32]=t("strong",null,"位置:",-1)),_(" "+a(K(e.bbox)),1)])]),t("div",ts,[t("div",{class:C(["badge",P(e.confidence)])},a(z(e.confidence)),3)])])]))),128))])])])])):h("",!0)]),t("div",ss,[B(l,{to:"/",class:"btn btn-primary btn-lg"},{default:F(()=>s[35]||(s[35]=[_(" 🔄 重新分析 ",-1)])),_:1,__:[35]})]),t("dialog",es,[t("div",os,[t("h3",ns,a(w.value),1),t("img",{src:A.value,alt:w.value,class:"w-full h-auto"},null,8,as),s[36]||(s[36]=t("div",{class:"modal-action"},[t("form",{method:"dialog"},[t("button",{class:"btn"},"关闭")])],-1))])])])}}}),cs=O(ls,[["__scopeId","data-v-26326529"]]);export{cs as default};
